<head>
  <title>Onescore</title>
  <meta content='width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0' name='viewport' />
  <meta content='yes' name='apple-mobile-web-app-capable' />
  <meta content='black-translucent' name='apple-mobile-web-app-status-bar-style' />
  <link href='img/icon16.png' rel='icon' sizes='16x16' type='image/png' />
  <link href='img/icon32.png' rel='icon' sizes='32x32' type='image/png' />
  <link href='img/icon96.png' rel='icon' sizes='96x96' type='image/png' />
  <link href='img/icon96.png' rel='apple-touch-icon' />
  <link href='img/icon96.png' rel='apple-touch-precomposed' />
</head>
<body>
  <div class='navbar navbar-fixed-top'>
    <div class='navbar-inner'>
      <header class='container'>
        {{> header }}
      </header>
    </div>
  </div>
  <div class='container' id='content'>
    {{> content }}
  </div>
</body>
<template name='content'>
  {{#if page "dashboard"}}
  <div class='row'>
    <div class='span8'>
      <section class='well'>
        <h3 class='heading'>Home</h3>
        {{> filter }}
        <div class='clearfix'></div>
        {{> home }}
      </section>
    </div>
    <div class='span4'>
      <aside class='well'>
        {{> userWidget }}
      </aside>
      <aside class='well'>
        <h3>FAQ</h3>
      </aside>
      <aside class='well'>
        <h3>Tags</h3>
      </aside>
      <aside class='well'>
        <h3>Quest Items</h3>
      </aside>
    </div>
  </div>
  {{/if}}
  {{#if page "achievements"}}
  <div class='row'>
    <div class='span4'>
      <aside class='well hidden-phone'>
        <h3>Tags</h3>
      </aside>
      <aside class='well hidden-phone'>
        <h3>Quest Items</h3>
      </aside>
    </div>
    <div class='span8'>
      <section class='well'>
        {{> achievements }}
      </section>
    </div>
  </div>
  {{/if}}
  {{#if page "ladder"}}
  <div class='row'>
    <div class='span4'>
      <aside class='well hidden-phone'>
        <h3>League</h3>
      </aside>
      <aside class='well hidden-phone'>
        <h3>???</h3>
      </aside>
      <aside class='well hidden-phone'>
        <h3>Quest Items</h3>
      </aside>
    </div>
    <div class='span8'>
      <section class='well'>
        <h3 class='heading'>Ladder</h3>
        {{> filter }}
        <div class='clearfix'></div>
        {{> ladder }}
      </section>
    </div>
  </div>
  {{/if}}
  {{#if page "profile"}}
  <div class='row'>
    <div class='span12'>
      <section class='well'>
        {{> userWidget }}
      </section>
    </div>
  </div>
  <div class='row'>
    <div class='span4'>
      {{> menu }}
      <aside class='well hidden-phone'>
        <h3>Tags</h3>
      </aside>
      <aside class='well hidden-phone'>
        <h3>Quest Items</h3>
      </aside>
    </div>
    <div class='span8'>
      <section class='well'>
        <h3 class='heading'>Activity</h3>
        {{> filter }}
        <div class='clearfix'></div>
        {{> accomplishments }}
      </section>
    </div>
  </div>
  {{/if}}
  {{#if page "activities"}}
  <div class='row'>
    <div class='span12'>
      <div class='well'>
        {{> activities }}
      </div>
    </div>
  </div>
  {{/if}}
  {{#if page "slides"}}
  <div class='row'>
    <div class='span12'>
      <div class='well'>
        {{> slideshows }}
      </div>
    </div>
  </div>
  {{/if}}
  {{#if page "feedback"}}
  <div class='row'>
    <div class='span12'>
      <div class='well'>
        <h3>Y U NO MAKE BETTER?</h3>
      </div>
    </div>
  </div>
  {{/if}}
</template>
<template name='tags'>
  <div class='tag-list'>
    {{#each tags}}
    <span class='tag label active' data-tag='{{tag}}'>
      {{tag}}
      <a class='remove' id='{{../_id}}' title='Remove this tag'>×</a>
    </span>
    {{/each}}
    {{#if addingTag}}
    <input class='edittag-input label input-mini' id='edittag-{{_id}}' type='text' />
    {{else}}
    <a class='add tag label' title='Add a tag'>+ tag</a>
    {{/if}}
  </div>
</template>
<template name='tagFilter'>
  <div class='tag-list' id='tag-filter'>
    <h6 class='tags'>Tags:</h6>
    {{#each tags}}
    <a class="tag label {{isActive "tagFilter" tag}}" data-tag="{{tag}}">
    {{tag}}
    <span class='count'>({{count}})</span>
    </a>
    {{/each}}
  </div>
</template>
<template name='menu'>
  <nav class='menu'>
    <ul class='nav nav-tabs nav-stacked'>
      <li>
        <a href='#'>
          <i class='icon-book'></i>
          Quests
        </a>
      </li>
      <li>
        <a href='#'>
          <i class='icon-star'></i>
          Favourites
        </a>
      </li>
      <li>
        <a href='#'>
          <i class='icon-pencil'></i>
          Edits
        </a>
      </li>
      <li>
        <a href='#'>
          <i class='icon-arrow-right'></i>
          Votes
        </a>
      </li>
    </ul>
  </nav>
</template>
<template name='filter'>
  <div class='filter'>
    <input class='input-medium search-query pull-right' placeholder='Search' type='text' />
    <nav class='nav nav-tabs'>
      <li class='active'>
        <a>All</a>
      </li>
      <li>
        <a>City</a>
      </li>
      <li>
        <a>Friends</a>
      </li>
    </nav>
    <div class='sort pull-left'>
      <span>Sort by:</span>
      <select class='span1'>
        <option>Hot</option>
        <option>New</option>
        <option>Best</option>
      </select>
    </div>
  </div>
</template>
<template name='header'>
  <a class='brand nav-img pull-left nav-item' href='dashboard'></a>
  <nav class='nav'>
    <li class='dropdown'>
      <a class='dropdown-toggle' data-toggle='dropdown'>{{#if session "category"}}
      <span>{{session "category"}}</span>
      {{else}}
      <span>Onescore</span>
      {{/if}}
      <b class='caret'></b></a>
      <ul class='dropdown-menu'>
        {{#each categories}}
        <li class='category' data-category='{{name}}'>
          <a class='nav-item'>{{name}}</a>
        </li>
        {{/each}}
      </ul>
    </li>
    {{#each items}}
    <li class="nav-{{url}} {{isActive "page" url}}">
    <a class='nav-item' href='{{url}}'>{{name}}</a>
    </li>
    {{/each}}
  </nav>
  {{#if currentUser}}
  <a class='profile-pic nav-item nav-img pull-right' href='profile'></a>
  <div class='score pull-right hidden-phone'><span class='value'>{{currentUser.score}}</span>
  <span class='dollar'></span></div>
  {{else}}
  <div class='login pull-right'>
    {{> loginButtons}}
  </div>
  {{/if}}
</template>
<template name='userWidget'>
  {{#if currentUser}}
  <div class='userWidget'>
    <a class='profile-pic pull-left' href=''></a>
    {{#unless editUsername}}
    <a class='edit pull-right'>(edit)</a>
    <h3 class='name'>{{currentUser.name}}</h3>
    {{else}}
    <input id='user-name' type='text' value='{{name}}' />
    {{/unless}}
    <h3 class='score'><span>{{currentUser.score}}</span>
    <span class='dollar dollar-green'></span></h3>
    <div class='clearfix'></div>
  </div>
  {{else}}
  <div class='login'>
    {{> loginButtons}}
  </div>
  {{/if}}
</template>
<template name='activities'>
  <div class='btn-group pull-left'>
    <a id="my-activities" class='btn btn-filter {{isActive "activity-filter-1" "my"}}' data-filter="my" data-which="1">My Activities</a>
    <a id="lva-activities" class='btn btn-filter {{isActive "activity-filter-1" "lva"}}' data-filter="lva" data-which="1">LVA-Team Activities</a>
  </div>
  <div class='btn-group pull-right'>
    <a id="fav-activities" class='btn btn-filter {{isActive "activity-filter-2" "fav"}}' data-filter="fav" data-which="2"><i class="icon-star"></i> Favourites</a>
    <a id="saved-activities" class='btn btn-filter {{isActive "activity-filter-2" "saved"}}' data-filter="saved" data-which="2"><i class="icon-edit"></i> Saved</a>
    <a id="pending-activities" class='btn btn-filter {{isActive "activity-filter-2" "pending"}}' data-filter="pending" data-which="2"><i class="icon-share"></i> Handed-In</a>
    <a id="done-activities" class='btn btn-filter {{isActive "activity-filter-2" "done"}}' data-filter="done" data-which="2"><i class="icon-check"></i> Evaluated</a>
  </div>
  <div class='clearfix'></div>
  {{> tagFilter }}
  <div class='activity create' id='create'>
    <div class='well'>
      <div class='text'>
        <h4>
          <a class='open'>Create New Activity</a>
        </h4>
        <p>Create an activity that others can accomplish</p>
      </div>
    </div>
  </div>
  {{#each activities}}
  {{> activity}}
  {{else}}
  {{#if noContent}}
  <div class='alert pull-left'>
    <strong>Warning!</strong>
    No activities matching the selection
  </div>
  {{else}}
  {{> loading}}
  {{/if}}
  {{/each}}
  <div class='modal activity-modal hide create-modal'>
    {{> createActivityModal}}
  </div>
  <div class='modal activity-modal hide accomplish-modal'>
    {{> accomplishActivityModal}}
  </div>
  <div class='clearfix'></div>
</template>
<template name='loading'>
  <div class='loading'>
    <img src='/loading.gif' />
  </div>
</template>
<template name='activity'>
  <div class='activity' id='activity-{{_id}}'>
    <div class='well'>
      <span class='count'>{{score}}</span>
      {{#unless userIn votes}}
      <a class='up icon-arrow-up' title='Vote Up'></a>
      <a class='down icon-arrow-down' title='Vote Down'></a>
      {{/unless}}
      <div class='pull-right'>
        {{#if belongsTo user}}
        <a class='remove icon-remove' title='Delete'></a>
        <a class='edit icon-pencil' title='Edit'></a>
        {{/if}}
        {{#if userIn likes}}
        <a class='unlike icon-star' title='Remove from Favourites'></a>
        {{else}}
        <a class='like icon-star-empty' title='Add to Favourites'></a>
        {{/if}}
      </div>
      <div class="text {{isMe user}} {{isLva user}}">
      <h4>
        <a class='open'>{{name}}</a>
      </h4>
      <p>{{{wrapTags short}}}</p>
      </div>
    </div>
  </div>
</template>
<template name='createActivityModal'>
  {{#with activity}}
  <div class='modal-header'>
    <button class='close' data-dismiss='modal' type='button'>×</button>
    <h2>{{#if title}} {{title}} {{else}} {{> loading}} {{/if}}</h2>
    {{> tags}}
  </div>
  <div class='modal-body'>
    <label>Activity name</label>
    <input class='activity-name' id='name-{{_id}}' type='text' value='{{name}}' />
    <label>Short description</label>
    <textarea class='description-short' id='short-{{_id}}' rows='4' type='text'>{{short}}</textarea>
    <span class='help-block'>
      Provide a short description of the contents of this activity.
      <br />
      HINT: You can include #tags here.
    </span>
    <label>Full description</label>
    <textarea class='description-full ta100' id='full-{{_id}}' rows='6' type='text'>{{full}}</textarea>
    <span class='help-block'>Provide an in-depth description of the contents, requirements and tasks which are needed to complete this activity.</span>
  </div>
  <div class='modal-footer'>
    <a class='btn' data-dismiss='modal'>Discard</a>
    <a class='create-activity btn btn-primary'>Save</a>
  </div>
  {{/with}}
</template>
<template name='accomplishActivityModal'>
  {{#with activity}}
  <div class='modal-header'>
    <button class='close' data-dismiss='modal' type='button'>×</button>
    <h2>{{#if name}} {{name}} {{else}} {{> loading}} {{/if}}</h2>
    {{> tags}}
  </div>
  <div class='modal-body'>
    <h3>Full description</h3>
    <p>{{full}}</p>
    <h3>Required work</h3>
    <label>Free Text</label>
    {{#with draft}}
    <textarea class='accomplish-text ta100' id='text-{{_id}}' placeholder='' rows='10' type='text'>{{text}}</textarea>
    {{/with}}
    <span class='help-block'>Write a text that fits the needs of this activity.</span>
  </div>
  <div class='modal-footer modal-separator'>
    <a class='save-activity btn'>
      <i class='icon-edit'>Save</i>
    </a>
    <a class='hand-in-activity btn btn-primary'>
      <i class='icon-share icon-white'></i>
      Hand-In
    </a>
  </div>
  {{else}}
  {{> loading}}
  {{/with}}
  <div class='modal-body'>
    <h3>Comments</h3>
    {{> dashboard}}
  </div>
</template>
<template name='dashboard'>
  <div class='text-wrapper'>
    <textarea class='comment-text ta100' rows='3'></textarea>
  </div>
  <div class='comments'>
    {{> comments}}
  </div>
</template>
<template name='ladder'>
  {{#each users}}
  {{> user}}
  {{else}}
  {{> placeholder}}
  {{/each}}
</template>
<template name='home'>
  {{#each accomplishments}}
  {{> accomplishment}}
  {{else}}
  {{> placeholder}}
  {{/each}}
</template>
<template name='accomplishments'>
  {{#each accomplishments}}
  {{> accomplishment}}
  {{else}}
  {{> placeholder}}
  {{/each}}
</template>
<template name='accomplishment'>
  {{#if achievement}}
  <div class='fold'>
    {{#with user}}
    {{> user}}
    {{/with}}
    {{#with achievement}}
    {{> achievement}}
    {{/with}}
    {{#if story}}
    <div class='story'>
      <div class='vote-container pull-left'>
        <div>
          <a class='vote' data-up='true'><i class="icon-arrow-up {{voted "up"}}" title="Vote up"></i></a>
        </div>
        <div>
          <span class='count'>{{score}}</span>
        </div>
        <div>
          <a class='vote' data-up='false'><i class="icon-arrow-down {{voted "down"}}" title="Vote down"></i></a>
        </div>
      </div>
      <div class='content'>
        {{#markdown}}{{story}}{{/markdown}}
      </div>
    </div>
    {{/if}}
  </div>
  {{/if}}
</template>
<template name='user'>
  <div class='user'>
    <a class='face vader profile-pic pull-left'></a>
    <div class='content'>
      <a class='name'>{{name}}</a>
      <em class='verb'>{{verb}}</em>
      <div class='score pull-right'><span class='value'>{{score}}</span>
      <span class='dollar dollar-green'></span></div>
    </div>
    <div class='clearfix'></div>
  </div>
</template>
<template name='placeholder'>
  {{#if noContent}}
  {{> noContent}}
  {{else}}
  {{> loading}}
  {{/if}}
</template>
<template name='achievements'>
  <h3 class='heading'>Achievements</h3>
  {{> filter}}
  {{#with newAchievement}}
  <button class="btn pull-right new {{isActive "expand" _id}}" title="Create new achievement"><i class="icon-file"></i></button>
  <div class='clearfix'></div>
  <div class='fold dummy'>
    {{> achievement}}
  </div>
  {{/with}}
  {{#each achievements}}
  <div class='fold'>
    {{> achievement}}
  </div>
  {{else}}
  {{> placeholder}}
  {{/each}}
</template>
<template name='achievement'>
  <article class='achievement {{completed}}'>
    <a class='value pull-right accomplish'>
      <span class='points'>{{score}}</span>
    </a>
    <div class='vote-container pull-right'>
      <div>
        <a class='vote' data-up='true'><i class="icon-arrow-up {{voted "up"}}" title="Vote up"></i></a>
      </div>
      <div>
        <span class='count'>{{score}}</span>
      </div>
      <div>
        <a class='vote' data-up='false'><i class="icon-arrow-down {{voted "down"}}" title="Vote down"></i></a>
      </div>
    </div>
    <a class='icon pull-left expand'></a>
    <div class='content'>
      <header class='head'>
        <nav class='menu pull-right'>
          <li class='expand'>
            <a title='Expand'>{{#if equals "expand" _id}}
            {{#if expandTab}}
            <i class="icon-chevron-up active"></i>
            {{else}}
            <i class="icon-chevron-down"></i>
            {{/if}}
            {{else}}
            <i class="icon-chevron-down"></i>
            {{/if}}</a>
          </li>
          <li class='fav'>
            <a title='Add to favourites'><i class="icon-star {{faved}}"></i></a>
          </li>
          <li class='edit'>
            <a title='Edit'><i class="icon-pencil {{#if equals "expandTab" "edit"}}{{isActive "expand" _id}}{{/if}}"></i></a>
          </li>
          <li class='talk'>
            <a title='Comment'><i class="icon-comment {{#if equals "expandTab" "talk"}}{{isActive "expand" _id}}{{/if}}"></i></a>
          </li>
        </nav>
        <h4 class='title expand'>
          {{#if title}}
          <a>{{title}}</a>
          {{else}}
          {{#if equals "newAchievement" _id}}
          <a class='edit'>Create new achievement</a>
          {{else}}
          <a style='font-weight: normal'>&lt;No title suggested&gt;</a>
          {{/if}}
          {{/if}}
        </h4>
      </header>
      <div class='description'>
        {{#if description}}
        <span>{{{wrapTags description}}}</span>
        {{else}}
        <span>This is a preview!</span>
        {{/if}}
      </div>
    </div>
    <div class='clearfix'></div>
  </article>
  {{#if equals "expand" _id}}{{#if expandTab}}
  {{> expandAchievement}}
  {{/if}}{{/if}}
</template>
<template name='titleSuggestions'>
  <table class='table table-condensed'>
    <thead>
      <tr>
        <th>Vote</th>
        <th>Score</th>
        <th>Title</th>
      </tr>
    </thead>
    <tbody>
      {{#each titles}}
      <tr>
        <td>
          <a class='vote' data-up='true'><i class="icon-arrow-up {{voted "up"}}" title="Vote up"></i></a>
          <a class='vote' data-up='false'><i class="icon-arrow-down {{voted "down"}}" title="Vote down"></i></a>
        </td>
        <td>
          <span>{{score}}</span>
        </td>
        <td>{{title}}</td>
      </tr>
      {{/each}}
    </tbody>
  </table>
</template>
<template name='editTabs'>
  {{#if equals "newAchievement" _id}}
  <h3 class='heading line'>Create new achievement</h3>
  {{else}}
  <nav class='nav nav-tabs'>
    <li class="{{isActive "expandTab" "info"}}">
    <a class='tab' data-tab='info'>Info</a>
    </li>
    <li class="{{isActive "expandTab" "edit"}}">
    <a class='tab' data-tab='edit'>Edit</a>
    </li>
    <li class="{{isActive "expandTab" "talk"}}">
    <a class='tab' data-tab='talk'>Comments</a>
    </li>
    <li class="{{isActive "expandTab" "accomplish"}}">
    <a class='tab' data-tab='accomplish'>Accomplish</a>
    </li>
  </nav>
  {{/if}}
</template>
<template name='expandAchievement'>
  {{> editTabs}}
  {{#if equals "expandTab" "info"}}
  {{/if}}
  {{#if equals "expandTab" "accomplish"}}
  {{> accomplish}}
  {{/if}}
  {{#if equals "expandTab" "edit"}}
  {{> editAchievement}}
  {{/if}}
  {{#if equals "expandTab" "talk"}}
  {{> dashboard}}
  {{/if}}
  {{#if equals "expandTab" "rev"}}
  <span>rev...</span>
  {{/if}}
</template>
<template name='accomplish'>
  <label class='control-label'>Tell your story: (optional)</label>
  <div class='btn-group'>
    <button class="btn text {{isActive "story" "text"}}" title="Text">
    <i class='icon-align-left'></i>
    </button>
    <button class="btn picture {{isActive "story" "picture"}}" title="Picture">
    <i class='icon-picture'></i>
    </button>
    <button class="btn link {{isActive "story" "link"}}" title="Link">
    <i class='icon-bookmark'></i>
    </button>
  </div>
  {{#if equals "story" "text"}}
  <div class='control-group'></div>
  <label class='control-label' for='accomplish-{{_id}}'>Text</label>
  <div class='controls'>
    <textarea class='ta100' id='accomplish-{{_id}}' rows='12'>{{#if accomplishment}}{{accomplishment.story}}{{/if}}</textarea>
    <span class='help-block'>
      <strong>HINT:</strong>
      You can style your post using markdown.
    </span>
  </div>
  {{/if}}
  <footer class='form-actions'>
    <button class='btn btn-primary btn-large create' style='margin-left: -20px'>Accomplish</button>
  </footer>
</template>
<template name='editAchievement'>
  {{#if equals "newAchievement" _id}}
  {{#if show "styleGuide"}}
  <div class='alert alert-block alert-info'>
    <a class='close' data-dismiss='alert' href='#'>×</a>
    <h4 class='alert-heading'>Achievement style guide</h4>
    <p>Achievements should have the following properties:</p>
    <dl>
      <dt>
        <h5 class='alert-heading'>Atomic</h5>
      </dt>
      <dd>Achievements should not be composed.</dd>
      <dt>
        <h5 class='alert-heading'>Universal</h5>
      </dt>
      <dd>Achievements should be easy to agree on.</dd>
      <dt>
        <h5 class='alert-heading'>Unique</h5>
      </dt>
      <dd>Check if the achievement already exists!</dd>
    </dl>
  </div>
  {{/if}}
  {{/if}}
  <div class='form-horizontal' id='form-{{_id}}'>
    <fieldset>
      <div class='control-group'>
        <label class='control-label' for='title-{{_id}}'>Title</label>
        <div class='controls'>
          <div class='input-append'><input class='span3 title' data-field='title' id='title-{{_id}}' type='text' /><button class='btn suggest' type='button'>Suggest</button></div>
          <p class='help-block heading'>
            <strong>NOTE:</strong>
            You don't have to suggest a title.
          </p>
          {{> titleSuggestions}}
        </div>
      </div>
      <div class='control-group'>
        <label class='control-label' for='description-{{_id}}'>Description</label>
        <div class='controls'>
          <textarea class='input-xlarge description lazy' data-field='description' id='description-{{_id}}' rows='4'>{{description}}</textarea>
          <p class='help-block'>
            What has to be done to complete this achievement?
            <br />
            <strong>HINT:</strong>
            You can include #tags here.
          </p>
        </div>
      </div>
      <div class='control-group'>
        <label class='control-label' for='category-{{_id}}'>Category</label>
        <div class='controls'>
          <select class='category lazy' data-field='category' id='category-{{_id}}'>
            <option></option>
            {{#each categories}}
            <option value="{{name}}" {{selected ../category}}>{{name}}</option>
            {{/each}}
          </select>
          <p class='help-block'>If it doesn't fit in anywhere, choose 'Random'</p>
        </div>
      </div>
      <footer class='form-actions'>
        <button class='btn btn-primary btn-large create'>Save</button>
      </footer>
    </fieldset>
  </div>
</template>
<template name='noContent'>
  <div class='fold'>
    <div class='alert'>
      <strong>Warning!</strong>
      No Content.
    </div>
  </div>
</template>
<template name='comments'>
  {{#each comments}}
  {{> comment}}
  {{#each replies}}
  {{> comment}}
  {{/each}}
  {{else}}
  {{> placeholder}}
  {{/each}}
</template>
<template name='comment'>
  <article class='comment {{nested}}' id='comment-{{_id}}'>
    {{> user}}
    <div class='sup'>
      <div class='pull-left'>
        <span class='name'>{{getUsername user}}</span>
        {{#if userIn likes}}
        <a class='unlike icon-star' title='Unlike'></a>
        {{else}}
        <a class='like icon-star-empty' title='Like'></a>
        {{/if}}
        <span class='count'>{{likesNum}}</span>
      </div>
      <div class='hud pull-right'>
        <span class='date'>{{formatDate date}}</span>
        {{#if belongsTo user}}
        <a class='remove icon-remove' title='Delete'></a>
        <a class='edit icon-pencil' title='Edit'></a>
        {{/if}}
        <a class='reply icon-share-alt' title='Reply'></a>
      </div>
      <div class='text'>
        {{#if editComment}}
        <div class='text-wrapper'>
          <textarea class='edit-text ta100' id='edit-{{_id}}' rows='3'>{{text}}</textarea>
        </div>
        {{else}}
        <p>{{mention}} {{{addLineBreaks text}}}</p>
        {{/if}}
      </div>
      {{#if addComment}}
      <div class='text-wrapper nested'>
        <textarea class='comment-text ta100' id='reply-{{_id}}' rows='3'></textarea>
      </div>
      {{/if}}
    </div>
  </article>
</template>
